Example csc commands for testing the compiled CSI. (We can remove this file further into development).

csc -e unix:///tmp/csi.sock controller create-volume webere_test_1 --cap "MULTI_NODE_MULTI_WRITER,mount," --params "volDirBasePath=webere_scratch,beegfsConf/sysMgmtdHost=10.113.72.217"
csc -e unix:///tmp/csi.sock controller delete-volume beegfs://10.113.72.217/webere_scratch/webere_test_1


// (jmccormi) Example csc command for testing node staging:

csc -e unix:///tmp/csi.sock node stage --staging-target-path="/mnt/jmccormi_test_1" --cap "MULTI_NODE_MULTI_WRITER,mount," --vol-context="beegfsConf/sysMgmtdHost=10.113.72.217,volDirBasePath=jmccormi_scratch,volume_id=beegfs://10.113.72.217/jmccormi_scratch/jmccormi_test_1" beegfs://10.113.72.217/jmccormi_scratch/jmccormi_test_1

csc -e unix:///tmp/csi.sock node stage --staging-target-path="/mnt/jmccormi_test_1" --cap "MULTI_NODE_MULTI_WRITER,mount," --vol-context="beegfsConf/sysMgmtdHost=10.113.72.217,volDirBasePath=jmccormi_scratch" beegfs://10.113.72.217/jmccormi_scratch/jmccormi_test_1

// (jmccormi) Example csc command for testing node unstaging: 

csc -e unix:///tmp/csi.sock node unstage --staging-target-path="/mnt/jmccormi_test_1" beegfs://10.113.72.217/jmccormi_scratch/jmccormi_test_1

csc -e unix:///tmp/csi.sock node publish --staging-target-path="/tmp/csi-data-dir/fake-volume-1/" --target-path="/tmp/fake-kubelet-dir/pods/fake-pod-1/volumes/fake-volume-1" --cap "MULTI_NODE_MULTI_WRITER,mount," --vol-context="beegfsConf/sysMgmtdHost=10.113.72.217,volDirBasePath=jmccormi_scratch,volume_id=beegfs://10.113.72.217/jmccormi_scratch/jmccormi_test_1" beegfs://10.113.72.217/jmccormi_scratch/jmccormi_test_1
csc -e unix:///tmp/csi.sock node unpublish --target-path="/tmp/fake-kubelet-dir/pods/fake-pod-1/volumes/fake-volume-1" beegfs://10.113.72.217/jmccormi_scratch/jmccormi_test_1

Demo commands:

Create volume
csc -e unix:///tmp/csi.sock controller create-volume volume1 --cap "MULTI_NODE_MULTI_WRITER,mount," --params "volDirBasePath=demo,beegfsConf/sysMgmtdHost=10.113.72.217"

Stage volume globally at /tmp/csi_data_dir/volume1
csc -e unix:///tmp/csi.sock node stage --staging-target-path="/tmp/csi_data_dir/volume1" --cap "MULTI_NODE_MULTI_WRITER,mount," --vol-context="beegfsConf/sysMgmtdHost=10.113.72.217,volDirBasePath=demo" beegfs://10.113.72.217/demo/volume1

Bind mount volume into /tmp/fake_kubelet_dir/pods/pod1/volumes/volume1
csc -e unix:///tmp/csi.sock node publish --staging-target-path="/tmp/csi_data_dir/volume1" --target-path="/tmp/fake_kubelet_dir/pods/pod1/volumes/volume1" --cap "MULTI_NODE_MULTI_WRITER,mount," --vol-context="beegfsConf/sysMgmtdHost=10.113.72.217,volDirBasePath=demo" beegfs://10.113.72.217/demo/volume1

Unmount volume from /tmp/fake_kubelet_dir/pods/pod1/volume1
csc -e unix:///tmp/csi.sock node unpublish --target-path="/tmp/fake_kubelet_dir/pods/pod1/volumes/volume1" beegfs://10.113.72.217/demo/volume1

Unstage volume globally from /tmp/csi_data_dir/volume1
csc -e unix:///tmp/csi.sock node unstage --staging-target-path="/tmp/csi_data_dir/volume1" beegfs://10.113.72.217/demo/volume1

Delete volume
csc -e unix:///tmp/csi.sock controller delete-volume beegfs://10.113.72.217/demo/volume1
